<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "var/www/html"

    # Serve React static files
    <Directory "/var/www/html">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable React Router - redirect all requests to index.html
        RewriteEngine On
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !^/api
        RewriteRule ^ index.html [L]
    </Directory>

    # Proxy API requests to backend (private EC2)
    # The BACKEND_PRIVATE_IP will be replaced during deployment
    ProxyPreserveHost On
    ProxyPass /api/ http://BACKEND_PRIVATE_IP:5000/
    ProxyPassReverse /api/ http://BACKEND_PRIVATE_IP:5000/

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
